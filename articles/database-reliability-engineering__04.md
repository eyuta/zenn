---
title: "【3章】データベースリライアビリティエンジニアリングの読書メモ"
emoji: "😺"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["oreilly", "DBRE"]
published: false
---

[O'Reilly Japan - データベースリライアビリティエンジニアリング](https://www.oreilly.co.jp/books/9784873119403/) の 4 章の読書メモです。

## 4. オペレーション

オペレーションの見える化(OpViz)は DBRE の要。
見える化によって日々変化する DB と付随するコンポーネントの状況を把握できる。

見える化のメリットは以下の通り。

- アラートの発生と収束
  - システムの壊れた or 壊れそうなタイミングを知ることで、SLO 違反を防ぐ
- パフォーマンス測定
  - 外れ値を含んだレイテンシを理解することで、現在のトレンドを把握できる
- キャパシティプラニング
  - リソースを有効に使用できていなければ、ここぞという場面でキャパシティ不足に陥る
- デバッグとポストモーテム
  - 問題の早期発見は早期解決につながる
  - 見える化によりシステム自体を改善し、回復力を高める
- ビジネス分析
  - ユーザーのシステム活用方法を知ることで、以下が分かる
    - 問題の与える影響を理解できる
    - システムのうち、価値を生み出している部分が分かる
    - その価値に対するコスト配分を考えるのに役立つ
- 原因と結果の相関分析
  - サービスに負荷がかかった際、インフラとアプリの両者がどのような動きをするのか分かる

この章では、OpViz の原則や分類、パターンを知る。

### 4.1 現在の見える化の標準仕様

見える化を進める理由は、

- この事象は SLO に対してどういった影響があるのか
- 障害はどのようにして、なぜ発生したのか

を知るため。

そのため、OpViz ツールは Ops チームだけではなく BI ツールとしても使う必要がある。
チームの垣根を超えて設計、構築、管理を行い、データを BI として活用できるようにする。

#### 4.1.1 見える化を BI のように扱う

究極の見える化とは、ビジネスがどのように動作し、アプリとインフラにより、ビジネスはどのような影響を受けるのかを、誰もが理解できる(=BI ツール)。

#### 4.1.2 仮想環境におけるクラスタの見える化

クラスタ構成の場合、個々のノードは常に動的。
そのため、メトリクスはホスト名や IP ではなく、マスター or スライブといったロール毎に保存されるべき。

#### 4.1.3 高分解能でのメトリクス収集

高分解能 == 1 秒以下のメトリクス収集感覚

頻繁に変化する CPU やデータベースの接続キューは、高分解能が必要。
一方で、ディスクの空き容量やヘルスチェックは 1 分以上のチェックで十分。

#### 4.1.4 アーキテクチャをシンプルに保つ

大事なことは、ノイズをゼロに抑えること。
多くのメトリクスを見るのではなく、アラートや人間の手が必要なレベルになる必要最小限のものに絞る。
本当に重要なメトリクスを見極め、取捨選択する文化を育てたい。

### 4.2 OpViz フレームワーク

### 4.3 データの入力

#### 4.3.1 テレメトリ／メトリクス

#### 4.3.2 イベント

#### 4.3.3 ログ

### 4.4 データの出力

### 4.5 監視の第一歩

#### 4.5.1 データは安全か

#### 4.5.2 サービスは落ちていないか

#### 4.5.3 顧客のサービス体験に痛みが伴っていないか

### 4.6 アプリケーションの計器

#### 4.6.1 分散トレーシング

#### 4.6.2 イベントとログ

### 4.7 サーバーやインスタンスの計器

#### 4.7.1 イベントとログ

### 4.8 データベースの計器

### 4.9 データベースの接続レイヤ

#### 4.9.1 利用率

#### 4.9.2 リソースの飽和点

#### 4.9.3 エラー

### 4.10 データベースの内部構造の見える化

#### 4.10.1 スループットとレイテンシのメトリクスの見える化

#### 4.10.2 コミット、再実行、ジャーナリングの見える化

#### 4.10.3 レプリケーション状態の見える化

#### 4.10.4 メモリ構造の見える化

#### 4.10.5 ロックと並行性の見える化

### 4.11 データベース内オブジェクトの見える化

#### 4.12 データベースクエリの見える化

#### 4.13 データベースのアサートとイベントの見える化

#### 4.14 まとめ
